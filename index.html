<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Roles - Nómina</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-100 p-10">

    <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-lg p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Generador de Rol de Pagos</h2>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Mes y Año</label>
                <input type="month" id="fechaMes" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Días Trabajados</label>
                    <input type="number" id="diasTrabajados" value="30" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Horas Extras ($)</label>
                    <input type="number" id="extras" value="0.00" step="0.01" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2">
                </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-md border text-sm">
                <p class="flex justify-between"><span>Sueldo Base (4.5h):</span> <span class="font-bold">$264.38</span></p>
                <p class="flex justify-between text-red-600"><span>IESS (9.45%):</span> <span class="font-bold">-$24.98</span></p>
                <div class="border-t my-2"></div>
                <p class="flex justify-between text-lg font-bold text-green-700"><span>A Pagar:</span> <span id="totalPagar">$239.40</span></p>
            </div>

            <button onclick="generarPDF()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition">
                Descargar PDF Firmable
            </button>
        </div>
    </div>

    <script>
        // Configuración Fija (Según tu contrato)
        const SUELDO_BASE = 264.38; 
        const IESS_PORCENTAJE = 0.0945; 
        
        // 1. Lógica de Cálculo en tiempo real (Opcional si quieres que se mueva al cambiar días)
        // Por ahora lo dejé fijo al contrato estándar.

        // 2. Función Generadora de PDF
        async function generarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Datos del Input
            const fechaInput = document.getElementById('fechaMes').value;
            const [year, month] = fechaInput.split('-');
            const dias = document.getElementById('diasTrabajados').value;
            const extras = parseFloat(document.getElementById('extras').value) || 0;

            // Cálculos
            const iessPersonal = (SUELDO_BASE * IESS_PORCENTAJE).toFixed(2);
            const totalIngresos = (SUELDO_BASE + extras).toFixed(2);
            const liquido = (totalIngresos - iessPersonal).toFixed(2);
            
            // Nombre del mes en texto
            const dateObj = new Date(year, month - 1);
            const mesNombre = dateObj.toLocaleString('es-ES', { month: 'long' }).toUpperCase();

            // --- DISEÑO DEL PDF ---
            doc.setFontSize(16);
            doc.text(`ROL DE PAGOS INDIVIDUAL`, 105, 20, null, null, 'center');
            doc.setFontSize(12);
            doc.text(`PERÍODO: ${mesNombre} ${year}`, 105, 30, null, null, 'center');

            doc.setFontSize(10);
            doc.text(`EMPLEADO: [NOMBRE DE LA EMPLEADA]`, 20, 50);
            doc.text(`CARGO: EMPLEADA DOMÉSTICA`, 20, 56);
            doc.text(`DÍAS LABORADOS: ${dias}`, 150, 50);

            // Línea separadora
            doc.line(20, 65, 190, 65);

            // Tabla Simple (Manual coordinates)
            let y = 75;
            doc.text("CONCEPTO", 20, y);
            doc.text("INGRESOS", 100, y, null, null, 'right');
            doc.text("DESCUENTOS", 150, y, null, null, 'right');
            
            y += 10;
            doc.text("Sueldo Unificado (Jornada Parcial)", 20, y);
            doc.text(`$ ${SUELDO_BASE.toFixed(2)}`, 100, y, null, null, 'right');

            if(extras > 0){
                y += 7;
                doc.text("Horas Suplementarias/Extras", 20, y);
                doc.text(`$ ${extras.toFixed(2)}`, 100, y, null, null, 'right');
            }

            y += 7;
            doc.text("Aporte Personal IESS (9.45%)", 20, y);
            doc.text(`$ ${iessPersonal}`, 150, y, null, null, 'right');

            // Totales
            y += 15;
            doc.line(20, y-5, 190, y-5);
            doc.setFont(undefined, 'bold');
            doc.text("LÍQUIDO A RECIBIR:", 20, y);
            doc.text(`$ ${liquido}`, 190, y, null, null, 'right');
            
            // Sección Firmas
            y += 40;
            doc.setFont(undefined, 'normal');
            doc.text("_____________________________", 20, y);
            doc.text("_____________________________", 120, y);
            doc.text("EMPLEADOR", 20, y+5);
            doc.text("RECIBÍ CONFORME (Trabajadora)", 120, y+5);

            // Guardar
            doc.save(`Rol_Pago_${mesNombre}_${year}.pdf`);
        }

        // Setear fecha actual por defecto
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
        document.getElementById('fechaMes').value = `${yyyy}-${mm}`;
    </script>
</body>
</html>
